"use strict";(self.webpackChunkdocs_website=self.webpackChunkdocs_website||[]).push([[20132],{15680:(e,n,t)=>{t.d(n,{xA:()=>d,yg:()=>y});var r=t(96540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var c=r.createContext({}),p=function(e){var n=r.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=p(e.components);return r.createElement(c.Provider,{value:n},e.children)},g="mdxType",s={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),g=p(t),u=a,y=g["".concat(c,".").concat(u)]||g[u]||s[u]||o;return t?r.createElement(y,i(i({ref:n},d),{},{components:t})):r.createElement(y,i({ref:n},d))}));function y(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var c in n)hasOwnProperty.call(n,c)&&(l[c]=n[c]);l.originalType=e,l[g]="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},8285:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>s,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=t(58168),a=(t(96540),t(15680));const o={title:"Sort \u6269\u5c55 Connector",sidebar_position:1},i="\u5982\u4f55\u6269\u5c55 Extract Node \u548c Load Node \u7c7b\u578b",l={unversionedId:"development/extension_sort/extension_connector",id:"development/extension_sort/extension_connector",title:"Sort \u6269\u5c55 Connector",description:"\u6269\u5c55 Extract & Load Node",source:"@site/i18n/zh-CN/docusaurus-plugin-content-docs/current/development/extension_sort/extension_connector.md",sourceDirName:"development/extension_sort",slug:"/development/extension_sort/extension_connector",permalink:"/zh-CN/docs/next/development/extension_sort/extension_connector",draft:!1,editUrl:"https://github.com/apache/inlong-website/edit/master/docs/development/extension_sort/extension_connector.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Sort \u6269\u5c55 Connector",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Manager \u81ea\u5b9a\u4e49\u63d2\u4ef6",permalink:"/zh-CN/docs/next/development/extension_manager/inlong_manager_plugin"},next:{title:"InLong \u5206\u62e3\u6570\u636e\u7ec4\u7ec7\u53ca\u534f\u8bae\u89e3\u6790",permalink:"/zh-CN/docs/next/development/extension_sort/inlong_sort_data_organization_and_binary_protocol"}},c={},p=[{value:"\u6269\u5c55 Extract &amp; Load Node",id:"\u6269\u5c55-extract--load-node",level:2},{value:"\u7b80\u4ecb",id:"\u7b80\u4ecb",level:3},{value:"\u589e\u52a0 Extract &amp; Load Node \u5b9a\u4e49",id:"\u589e\u52a0-extract--load-node-\u5b9a\u4e49",level:3},{value:"InlongMetric",id:"inlongmetric",level:4},{value:"Metadata",id:"metadata",level:4},{value:"\u6269\u5c55 Apache Flink Connector",id:"\u6269\u5c55-apache-flink-connector",level:2},{value:'<span id="jump1">\u5982\u4f55\u96c6\u6210 Inlong Audit \u5230\u81ea\u5b9a\u4e49 Connector</span>',id:"\u5982\u4f55\u96c6\u6210-inlong-audit-\u5230\u81ea\u5b9a\u4e49-connector",level:2}],d={toc:p},g="wrapper";function s(e){let{components:n,...t}=e;return(0,a.yg)(g,(0,r.A)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"\u5982\u4f55\u6269\u5c55-extract-node-\u548c-load-node-\u7c7b\u578b"},"\u5982\u4f55\u6269\u5c55 Extract Node \u548c Load Node \u7c7b\u578b"),(0,a.yg)("h2",{id:"\u6269\u5c55-extract--load-node"},"\u6269\u5c55 Extract & Load Node"),(0,a.yg)("h3",{id:"\u7b80\u4ecb"},"\u7b80\u4ecb"),(0,a.yg)("p",null,"Extract \u8282\u70b9\u662f\u57fa\u4e8e ",(0,a.yg)("a",{href:"https://flink.apache.org/"},"Apache Flink",(0,a.yg)("sup",null,"\xae"))," \u7684\nSource Connectors \u7528\u4e8e\u4ece\u4e0d\u540c\u7684\u6e90\u7cfb\u7edf\u62bd\u53d6\u6570\u636e\u3002\nLoad \u8282\u70b9\u662f\u57fa\u4e8e ",(0,a.yg)("a",{href:"https://flink.apache.org/"},"Apache Flink",(0,a.yg)("sup",null,"\xae"))," \u7684 Sink\nConnectors \u7528\u4e8e\u5c06\u6570\u636e\u52a0\u8f7d\u5230\u4e0d\u540c\u7684\u5b58\u50a8\u7cfb\u7edf\u3002"),(0,a.yg)("p",null,"Apache InLong Sort \u542f\u52a8\u65f6\u901a\u8fc7\u5c06\u4e00\u7ec4 Extract \u548c Load Node \u914d\u7f6e\u7ffb\u8bd1\u6210\u5bf9\u5e94\u7684 Flink SQL \u5e76\u63d0\u4ea4\u5230 Flink\n\u96c6\u7fa4\uff0c\u62c9\u8d77\u7528\u6237\u6307\u5b9a\u7684\u6570\u636e\u62bd\u53d6\u548c\u5165\u5e93\u4efb\u52a1\u3002"),(0,a.yg)("h3",{id:"\u589e\u52a0-extract--load-node-\u5b9a\u4e49"},"\u589e\u52a0 Extract & Load Node \u5b9a\u4e49"),(0,a.yg)("p",null,"\u81ea\u5b9a\u4e49 ",(0,a.yg)("inlineCode",{parentName:"p"},"Extract Node")," \u9700\u8981\u7ee7\u627f ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.protocol.node.ExtractNode"),"\n\u7c7b\uff0c\u81ea\u5b9a\u4e49 ",(0,a.yg)("inlineCode",{parentName:"p"},"Load Node")," \u9700\u8981\u7ee7\u627f ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.protocol.node.LoadNode")," \u7c7b\uff0c\n\u4e24\u8005\u90fd\u81f3\u5c11\u9700\u8981\u9009\u62e9\u6027\u5b9e\u73b0 ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.protocol.node.Node")," \u63a5\u53e3\u4e2d\u7684\u65b9\u6cd5"),(0,a.yg)("table",null,(0,a.yg)("thead",{parentName:"table"},(0,a.yg)("tr",{parentName:"thead"},(0,a.yg)("th",{parentName:"tr",align:null},"\u65b9\u6cd5\u540d"),(0,a.yg)("th",{parentName:"tr",align:null},"\u542b\u4e49"),(0,a.yg)("th",{parentName:"tr",align:null},"\u9ed8\u8ba4\u503c"))),(0,a.yg)("tbody",{parentName:"table"},(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"getId"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u8282\u70b9ID"),(0,a.yg)("td",{parentName:"tr",align:null},"Inlong StreamSource Id")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"getName"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u8282\u70b9\u540d"),(0,a.yg)("td",{parentName:"tr",align:null},"Inlong StreamSource Name")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"getFields"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u5b57\u6bb5\u4fe1\u606f"),(0,a.yg)("td",{parentName:"tr",align:null},"Inlong Stream \u5b9a\u4e49\u7684\u5b57\u6bb5")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"getProperties"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u8282\u70b9\u989d\u5916\u5c5e\u6027"),(0,a.yg)("td",{parentName:"tr",align:null},"\u7a7a Map")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"tableOptions"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6 Flink SQL \u8868\u5c5e\u6027"),(0,a.yg)("td",{parentName:"tr",align:null},"\u8282\u70b9\u989d\u5916\u5c5e\u6027")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"genTableName"),(0,a.yg)("td",{parentName:"tr",align:null},"\u751f\u6210 Flink SQL \u8868\u540d"),(0,a.yg)("td",{parentName:"tr",align:null},"\u65e0\u9ed8\u8ba4\u503c")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"getPrimaryKey"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u4e3b\u952e"),(0,a.yg)("td",{parentName:"tr",align:null},"null")),(0,a.yg)("tr",{parentName:"tbody"},(0,a.yg)("td",{parentName:"tr",align:null},"getPartitionFields"),(0,a.yg)("td",{parentName:"tr",align:null},"\u83b7\u53d6\u5206\u533a\u5b57\u6bb5"),(0,a.yg)("td",{parentName:"tr",align:null},"null")))),(0,a.yg)("p",null,"\u540c\u65f6\uff0cSort \u8fd8\u589e\u52a0\u4e86 ",(0,a.yg)("inlineCode",{parentName:"p"},"InlongMetric")," \u548c ",(0,a.yg)("inlineCode",{parentName:"p"},"Metadata")," \u4e24\u4e2a\u989d\u5916\u7684\u63a5\u53e3\u7528\u6765\u652f\u6301\u66f4\u4e30\u5bcc\u7684\u8bed\u4e49\u3002"),(0,a.yg)("h4",{id:"inlongmetric"},"InlongMetric"),(0,a.yg)("p",null,"\u5982\u679c\u81ea\u5b9a\u4e49\u8282\u70b9\u9700\u8981\u4e0a\u62a5 Inlong \u6307\u6807\uff0c\u5219\u9700\u8981\u5b9e\u73b0 ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.protocol.InlongMetric")," \u63a5\u53e3\u3002\nInlong Sort \u89e3\u6790\u914d\u7f6e\u65f6\u4f1a\u5411 table option \u4e2d\u589e\u52a0\n",(0,a.yg)("inlineCode",{parentName:"p"},"'inlong.metric.labels' = 'groupId={g}&streamId={s}&nodeId={n}'")," \u542f\u52a8\u53c2\u6570\uff0c\u5e76\u4ee5\u6b64\u6765\u914d\u7f6e Inlong Audit\u3002\n\u8be6\u60c5\u8bf7\u67e5\u770b\n",(0,a.yg)("a",{parentName:"p",href:"#jump1"},"\u5982\u4f55\u96c6\u6210 Inlong Audit \u5230\u81ea\u5b9a\u4e49 Connector")),(0,a.yg)("h4",{id:"metadata"},"Metadata"),(0,a.yg)("p",null,"\u5982\u679c\u81ea\u5b9a\u4e49\u8282\u70b9\u9700\u8981\u6307\u5b9a\u67d0\u4e2a\u5b57\u6bb5\u4e3a Flink SQL \u7684 Metadata \u5b57\u6bb5\uff0c\u5219\u9700\u8981\u5b9e\u73b0 ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.protocol.Metadata")," \u63a5\u53e3\u3002\nInlong Sort \u89e3\u6790\u914d\u7f6e\u65f6\u4f1a\u81ea\u52a8\u5c06\u5bf9\u5e94\u7684\u5b57\u6bb5\u6807\u8bb0\u4e3a Metadata\u3002"),(0,a.yg)("h2",{id:"\u6269\u5c55-apache-flink-connector"},"\u6269\u5c55 Apache Flink Connector"),(0,a.yg)("p",null,"Sort \u57fa\u4e8e Apache Flink 1.15 \u7248\u672c\u5b9e\u73b0\u3002\u5982\u4f55\u6269\u5c55 Apache Flink Connector\n\u53ef\u4ee5\u53c2\u8003 ",(0,a.yg)("a",{href:"https://nightlies.apache.org/flink/flink-docs-release-1.15/zh/docs/dev/table/sourcessinks/"},"\nUser-defined Sources & Sinks")),(0,a.yg)("h2",{id:"\u5982\u4f55\u96c6\u6210-inlong-audit-\u5230\u81ea\u5b9a\u4e49-connector"},(0,a.yg)("span",{id:"jump1"},"\u5982\u4f55\u96c6\u6210 Inlong Audit \u5230\u81ea\u5b9a\u4e49 Connector")),(0,a.yg)("p",null,"Inlong Sort \u5c06\u6307\u6807\u4e0a\u62a5\u7684\u6d41\u7a0b\u5c01\u88c5\u5728\u4e86 ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.base.metric.SourceExactlyMetric"),"\n\u548c ",(0,a.yg)("inlineCode",{parentName:"p"},"org.apache.inlong.sort.base.metric.SinkExactlyMetric")," \u7c7b\u4e2d\u3002\u5f00\u53d1\u8005\u53ea\u9700\u8981\u6839\u636e Source/Sink \u7c7b\u578b\u521d\u59cb\u5316\u5bf9\u5e94\u7684 ",(0,a.yg)("inlineCode",{parentName:"p"},"Metric")," \u5bf9\u8c61\uff0c\u5219\u53ef\u4ee5\u5b9e\u73b0\u6307\u6807\u4e0a\u62a5\u3002"),(0,a.yg)("p",null,"\u901a\u5e38\u7684\u505a\u6cd5\u662f\u5728\u6784\u9020 Source/Sink \u65f6\u4f20\u9012\u4f8b\u5982 InLong Audit \u5730\u5740\uff0c\u5728\u521d\u59cb\u5316 Source/Sink \u7b97\u5b50\u8c03\u7528 open() \u65b9\u6cd5\u65f6\u8fdb\u884c\u521d\u59cb\u5316 ",(0,a.yg)("inlineCode",{parentName:"p"},"SourceExactlyMetric/SinkExactlyMetric")," \u5bf9\u8c61\u3002\n\u5728\u5904\u7406\u5b9e\u9645\u6570\u636e\u540e\u518d\u8c03\u7528\u5bf9\u5e94\u7684\u5ba1\u8ba1\u4e0a\u62a5\u65b9\u6cd5\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"public class StarRocksDynamicSinkFunctionV2<T> extends StarRocksDynamicSinkFunctionBase<T> {\n\n    private static final long serialVersionUID = 1L;\n    private static final Logger log = LoggerFactory.getLogger(StarRocksDynamicSinkFunctionV2.class);\n\n    private transient SinkExactlyMetric sinkExactlyMetric;\n\n    private String inlongMetric;\n    private String auditHostAndPorts;\n    private String auditKeys;\n    private String stateKey;\n\n    public StarRocksDynamicSinkFunctionV2(StarRocksSinkOptions sinkOptions,\n            TableSchema schema,\n            StarRocksIRowTransformer<T> rowTransformer, String inlongMetric,\n            String auditHostAndPorts, String auditKeys) {\n        this.sinkOptions = sinkOptions;\n        \n        // pass the params of inlong audit\n        this.auditHostAndPorts = auditHostAndPorts;\n        this.inlongMetric = inlongMetric;\n        this.auditKeys = auditKeys;\n    }\n\n    @Override\n    public void open(Configuration parameters) {\n\n        // init SinkExactlyMetric in open()\n        MetricOption metricOption = MetricOption.builder().withInlongLabels(inlongMetric)\n                .withAuditAddress(auditHostAndPorts)\n                .withAuditKeys(auditKeys)\n                .build();\n\n        if (metricOption != null) {\n            sinkExactlyMetric = new SinkExactlyMetric(metricOption, getRuntimeContext().getMetricGroup());\n        }\n    }\n    \n    @Override\n    public void invoke(T value, Context context)\n            throws IOException, ClassNotFoundException, JSQLParserException {\n        Object[] data = rowTransformer.transform(value, sinkOptions.supportUpsertDelete());\n\n        sinkManager.write(\n                null,\n                sinkOptions.getDatabaseName(),\n                sinkOptions.getTableName(),\n                serializer.serialize(schemaUtils.filterOutTimeField(data)));\n\n        // output audit after write data to sink\n        if (sinkExactlyMetric != null) {\n            sinkExactlyMetric.invoke(1, getDataSize(value), schemaUtils.getDataTime(data));\n        }\n    }\n")))}s.isMDXComponent=!0}}]);